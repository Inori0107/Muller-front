import{m as ne,q as ue,x as re,z as de,L as ie,b as e,Y,r as $,Z as ce,o as C,d as U,w as a,V as y,as as A,f as i,c as Z,F as j,k as H,Q as K,ao as h,t as k,at as O,S as J,O as t,R as me,aq as L,an as W,ar as pe,h as D,a as fe,e as ve,g as _e}from"./index-upXNNMXx.js";import{c as X,a as N,b as ge,u as ee,e as q,V as ae,f as Ve}from"./index.esm-B90E9a3P.js";import{V as I}from"./VRow-BS6c4VkO.js";import{V as d}from"./VCol-B9PS1-nb.js";import{V as le}from"./VContainer-DPmPzo-T.js";import{b as G}from"./route-block-B_A1xBdJ.js";import{V as be}from"./VDivider-ChAcBHJJ.js";import{V as ke,c as ye,a as Q,b as xe,d as E}from"./VList-CegBJtsB.js";import{V as Ce}from"./VTextarea-DOunLD3N.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./ssrBoot-DWx4fxk8.js";const Ie=ne({start:Boolean,end:Boolean,...ue(),...re()},"VListItemAction"),Se=de()({name:"VListItemAction",props:Ie(),setup(b,v){let{slots:_}=v;return ie(()=>e(b.tag,{class:["v-list-item-action",{"v-list-item-action--start":b.start,"v-list-item-action--end":b.end},b.class],style:b.style},_)),{}}}),we={__name:"ticketManage",props:{sessionId:{type:String,required:!0}},setup(b){const{apiAuth:v}=W(),_=Y(),c=b,m=$({open:!1,id:""}),F=r=>{r?(m.value.id=r._id,g.value.value=r.name,V.value.value=r.price):(m.value.id="",x()),m.value.open=!0},T=()=>{m.value.open=!1,x()},R=X({name:N().required("票券名稱必填"),price:ge().typeError("票券價格格式錯誤").required("票券價格必填").min(0,"票券價格不能小於 0")}),{handleSubmit:M,isSubmitting:S,resetForm:x}=ee({validationSchema:R,initialValues:{name:"",price:0}}),g=q("name"),V=q("price"),w=M(async r=>{var u,o;try{const p={name:r.name,price:r.price,s_id:c.sessionId};m.value.id===""?await v.post("/ticket",p):await v.patch(`/ticket/${m.value.id}`,p),_({text:m.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),T(),B()}catch(p){_({text:((o=(u=p==null?void 0:p.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),P=$([]),B=async()=>{var r,u;try{const{data:o}=await v.get("/ticket/all",{params:{s_id:c.sessionId}});P.value=o.result.data}catch(o){_({text:((u=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return ce(()=>c.sessionId,()=>{B()},{immediate:!0}),(r,u)=>(C(),U(le,null,{default:a(()=>[e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(y,{color:"green",onClick:u[0]||(u[0]=A(o=>F(null),["stop"]))},{default:a(()=>[i("新增門票")]),_:1})]),_:1}),e(I,null,{default:a(()=>[(C(!0),Z(j,null,H(P.value,o=>(C(),U(d,{key:o._id,class:"mb-4","no-gutters":""},{default:a(()=>[e(K,null,{default:a(()=>[e(I,{class:"pa-4"},{default:a(()=>[e(h,null,{default:a(()=>[i(k(o.name),1)]),_:2},1024),e(h,null,{default:a(()=>[i(k(o.price),1)]),_:2},1024),e(O,null,{default:a(()=>[e(y,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:A(p=>F(o),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(J,{modelValue:m.value.open,"onUpdate:modelValue":u[3]||(u[3]=o=>m.value.open=o),persistent:"",width:"500"},{default:a(()=>[e(ae,{onSubmit:A(t(w),["prevent"]),disabled:t(S)},{default:a(()=>[e(K,null,{default:a(()=>[e(h,null,{default:a(()=>[i(k(m.value.id?"編輯門票":"新增門票"),1)]),_:1}),e(me,null,{default:a(()=>[e(L,{label:"名稱",modelValue:t(g).value.value,"onUpdate:modelValue":u[1]||(u[1]=o=>t(g).value.value=o),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),e(L,{label:"價格",type:"number",min:"0",modelValue:t(V).value.value,"onUpdate:modelValue":u[2]||(u[2]=o=>t(V).value.value=o),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(O,null,{default:a(()=>[e(y,{color:"red",loading:t(S),onClick:T},{default:a(()=>[i("取消")]),_:1},8,["loading"]),e(y,{color:"green",type:"submit",loading:t(S)},{default:a(()=>[i("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]),_:1}))}},$e=D("h1",{class:"text-center"},"場次管理",-1),Le=D("strong",null,"系列名稱",-1),qe=D("strong",null,"地點",-1),De=D("strong",null,"時間",-1),Fe=D("strong",null,"描述",-1),Me=D("strong",null,"編輯",-1),Pe={__name:"sessionManage",setup(b){const{apiAuth:v}=W(),_=Y(),c=$({open:!1,id:""}),m=n=>{n?(c.value.id=n._id,x.value.value=n.name,g.value.value=n.location,V.value.value=P(n.date),w.value.value=n.description):(c.value.id="",S()),c.value.open=!0},F=()=>{c.value.open=!1,S()},T=X({name:N().required("場次名稱必填"),location:N().required("場次位置必填"),date:Ve().required("場次日期必填"),description:N().required("場次描述必填")}),{handleSubmit:R,isSubmitting:M,resetForm:S}=ee({validationSchema:T,initialValues:{name:"",location:"",date:"",description:""}}),x=q("name"),g=q("location"),V=q("date"),w=q("description"),P=n=>new Date(n).toISOString().split("T")[0],B=R(async n=>{var s,f;try{const l={name:n.name,location:n.location,date:n.date,description:n.description};c.value.id===""?await v.post("/session",l):await v.patch(`/session/${c.value.id}`,l),_({text:c.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),F(),p(!0)}catch(l){_({text:((f=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),r=$([]),u=$(""),o=$(!0),p=async n=>{var s,f;o.value=!0;try{const{data:l}=await v.get("/session",{params:{search:u.value}});r.value=l.result.data}catch(l){_({text:((f=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"red"}})}o.value=!1},te=n=>{r.value[n].expanded=!r.value[n].expanded},se=n=>{m(n)};return p(),(n,s)=>{const f=fe("v-list-item-content");return C(),U(le,null,{default:a(()=>[e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[$e]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(y,{color:"green",onClick:s[0]||(s[0]=l=>m(null))},{default:a(()=>[i("新增場次")]),_:1})]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(L,{label:"搜尋",modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=l=>u.value=l),"append-icon":"mdi-magnify","onClick:append":s[2]||(s[2]=l=>p(!0)),onKeydown:s[3]||(s[3]=pe(l=>p(!0),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1}),e(I,{class:"text-center mb-2"},{default:a(()=>[e(d,{cols:"3"},{default:a(()=>[Le]),_:1}),e(d,{cols:"2"},{default:a(()=>[qe]),_:1}),e(d,{cols:"2"},{default:a(()=>[De]),_:1}),e(d,{cols:"3"},{default:a(()=>[Fe]),_:1}),e(d,{cols:"1"},{default:a(()=>[Me]),_:1})]),_:1}),e(be,{class:"mx-6"}),e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(ke,null,{default:a(()=>[(C(!0),Z(j,null,H(r.value,(l,z)=>(C(),U(ye,{key:l._id,value:l.expanded,onClick:oe=>te(z)},{activator:a(()=>[e(Q,{class:"text-center"},{default:a(()=>[e(I,{align:"center"},{default:a(()=>[e(d,{cols:"3"},{default:a(()=>[e(f,null,{default:a(()=>[e(xe,null,{default:a(()=>[i(k(l.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"2"},{default:a(()=>[e(f,null,{default:a(()=>[e(E,null,{default:a(()=>[i(k(l.location),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"2"},{default:a(()=>[e(f,null,{default:a(()=>[e(E,null,{default:a(()=>[i(k(P(l.date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"3"},{default:a(()=>[e(f,null,{default:a(()=>[e(E,null,{default:a(()=>[i(k(l.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"1"},{default:a(()=>[e(Se,null,{default:a(()=>[e(y,{icon:"",variant:"text",color:"blue",onClick:A(oe=>se(l,z),["stop"])},{default:a(()=>[e(ve,null,{default:a(()=>[i("mdi-pencil")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),l.expanded?(C(),U(Q,{key:0},{default:a(()=>[e(f,null,{default:a(()=>[e(we,{sessionId:l._id},null,8,["sessionId"])]),_:2},1024)]),_:2},1024)):_e("",!0)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(J,{modelValue:c.value.open,"onUpdate:modelValue":s[8]||(s[8]=l=>c.value.open=l),persistent:"",width:"500"},{default:a(()=>[e(ae,{onSubmit:A(t(B),["prevent"]),disabled:t(M)},{default:a(()=>[e(K,null,{default:a(()=>[e(h,null,{default:a(()=>[i(k(c.value.id?"編輯場次":"新增場次"),1)]),_:1}),e(L,{label:"名稱",modelValue:t(x).value.value,"onUpdate:modelValue":s[4]||(s[4]=l=>t(x).value.value=l),"error-messages":t(x).errorMessage.value},null,8,["modelValue","error-messages"]),e(L,{label:"地點",modelValue:t(g).value.value,"onUpdate:modelValue":s[5]||(s[5]=l=>t(g).value.value=l),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),e(L,{label:"日期",type:"date",modelValue:t(V).value.value,"onUpdate:modelValue":s[6]||(s[6]=l=>t(V).value.value=l),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),e(Ce,{label:"描述",modelValue:t(w).value.value,"onUpdate:modelValue":s[7]||(s[7]=l=>t(w).value.value=l),"error-messages":t(w).errorMessage.value},null,8,["modelValue","error-messages"]),e(O,null,{default:a(()=>[e(y,{color:"red",loading:t(M),onClick:F},{default:a(()=>[i("取消")]),_:1},8,["loading"]),e(y,{color:"green",type:"submit",loading:t(M)},{default:a(()=>[i("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]),_:1})}}};typeof G=="function"&&G(Pe);export{Pe as default};
