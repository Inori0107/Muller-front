import{N as ne,O as ue,P as re,Q as de,R as ie,b as e,n as Q,r as $,H as ce,o as C,d as U,w as a,V as y,v as q,f as i,c as j,F as J,k as W,z as K,at as h,t as k,aw as O,B as X,s as t,A as me,q as L,x as Y,av as pe,h as A,a as ve,e as fe,g as _e}from"./index-DwYRbOHb.js";import{c as Z,a as N,e as ge,u as ee,b as P,V as ae,h as Ve}from"./index.esm-HMliXh7V.js";import{V as I}from"./VRow-8qCsRklR.js";import{V as d}from"./VCol-TwVtcuEv.js";import{V as le}from"./VContainer-Cgmx8SZ0.js";import{b as G}from"./route-block-B_A1xBdJ.js";import{V as be}from"./VDivider-CcKHhT2V.js";import{V as ke,c as ye,a as H,b as xe,d as E}from"./VList-D-aaq9kK.js";import{V as Ce}from"./VTextarea-D9PJkED8.js";import"./ssrBoot-DBE8DRGf.js";const Ie=ne({start:Boolean,end:Boolean,...ue(),...re()},"VListItemAction"),we=de()({name:"VListItemAction",props:Ie(),setup(b,f){let{slots:_}=f;return ie(()=>e(b.tag,{class:["v-list-item-action",{"v-list-item-action--start":b.start,"v-list-item-action--end":b.end},b.class],style:b.style},_)),{}}}),Se={__name:"ticketManage",props:{sessionId:{type:String,required:!0}},setup(b){const{apiAuth:f}=Y(),_=Q(),c=b,m=$({open:!1,id:""}),D=r=>{r?(m.value.id=r._id,g.value.value=r.name,V.value.value=r.price):(m.value.id="",x()),m.value.open=!0},B=()=>{m.value.open=!1,x()},R=Z({name:N().required("票券名稱必填"),price:ge().typeError("票券價格格式錯誤").required("票券價格必填").min(0,"票券價格不能小於 0")}),{handleSubmit:F,isSubmitting:w,resetForm:x}=ee({validationSchema:R,initialValues:{name:"",price:0}}),g=P("name"),V=P("price"),S=F(async r=>{var u,o;try{const p={name:r.name,price:r.price,s_id:c.sessionId};m.value.id===""?await f.post("/ticket",p):await f.patch(`/ticket/${m.value.id}`,p),_({text:m.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),B(),T()}catch(p){_({text:((o=(u=p==null?void 0:p.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),M=$([]),T=async()=>{var r,u;try{const{data:o}=await f.get("/ticket/all",{params:{s_id:c.sessionId}});M.value=o.result.data}catch(o){_({text:((u=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:u.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return ce(()=>c.sessionId,()=>{T()},{immediate:!0}),(r,u)=>(C(),U(le,null,{default:a(()=>[e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(y,{color:"green",onClick:u[0]||(u[0]=q(o=>D(null),["stop"]))},{default:a(()=>[i("新增門票")]),_:1})]),_:1}),e(I,null,{default:a(()=>[(C(!0),j(J,null,W(M.value,o=>(C(),U(d,{key:o._id,class:"mb-4","no-gutters":""},{default:a(()=>[e(K,null,{default:a(()=>[e(I,{class:"pa-4"},{default:a(()=>[e(h,null,{default:a(()=>[i(k(o.name),1)]),_:2},1024),e(h,null,{default:a(()=>[i(k(o.price),1)]),_:2},1024),e(O,null,{default:a(()=>[e(y,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:q(p=>D(o),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(X,{modelValue:m.value.open,"onUpdate:modelValue":u[3]||(u[3]=o=>m.value.open=o),persistent:"",width:"500"},{default:a(()=>[e(ae,{onSubmit:q(t(S),["prevent"]),disabled:t(w)},{default:a(()=>[e(K,null,{default:a(()=>[e(h,null,{default:a(()=>[i(k(m.value.id?"編輯門票":"新增門票"),1)]),_:1}),e(me,null,{default:a(()=>[e(L,{label:"名稱",modelValue:t(g).value.value,"onUpdate:modelValue":u[1]||(u[1]=o=>t(g).value.value=o),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),e(L,{label:"價格",type:"number",min:"0",modelValue:t(V).value.value,"onUpdate:modelValue":u[2]||(u[2]=o=>t(V).value.value=o),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(O,null,{default:a(()=>[e(y,{color:"red",loading:t(w),onClick:B},{default:a(()=>[i("取消")]),_:1},8,["loading"]),e(y,{color:"green",type:"submit",loading:t(w)},{default:a(()=>[i("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]),_:1}))}},$e=A("h1",{class:"text-center"},"票務管理",-1),Le=A("strong",null,"系列名稱",-1),Pe=A("strong",null,"地點",-1),Ae=A("strong",null,"時間",-1),De=A("strong",null,"描述",-1),Fe=A("strong",null,"編輯",-1),Me={__name:"sessionManage",setup(b){const{apiAuth:f}=Y(),_=Q(),c=$({open:!1,id:""}),m=n=>{n?(c.value.id=n._id,x.value.value=n.name,g.value.value=n.location,V.value.value=M(n.date),S.value.value=n.description):(c.value.id="",w()),c.value.open=!0},D=()=>{c.value.open=!1,w()},B=Z({name:N().required("場次名稱必填"),location:N().required("場次位置必填"),date:Ve().required("場次日期必填"),description:N().required("場次描述必填")}),{handleSubmit:R,isSubmitting:F,resetForm:w}=ee({validationSchema:B,initialValues:{name:"",location:"",date:"",description:""}}),x=P("name"),g=P("location"),V=P("date"),S=P("description"),M=n=>new Date(n).toISOString().split("T")[0],T=R(async n=>{var s,v;try{const l={name:n.name,location:n.location,date:n.date,description:n.description};c.value.id===""?await f.post("/session",l):await f.patch(`/session/${c.value.id}`,l),_({text:c.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),D(),p(!0)}catch(l){_({text:((v=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:v.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),r=$([]),u=$(""),o=$(!0),p=async n=>{var s,v;o.value=!0;try{const{data:l}=await f.get("/session",{params:{search:u.value}});r.value=l.result.data}catch(l){_({text:((v=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:v.message)||"發生錯誤",snackbarProps:{color:"red"}})}o.value=!1},te=n=>{r.value[n].expanded=!r.value[n].expanded},se=n=>{m(n)};return p(),(n,s)=>{const v=ve("v-list-item-content");return C(),U(le,null,{default:a(()=>[e(I,{class:"my-8"},{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[$e]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(y,{color:"green",onClick:s[0]||(s[0]=l=>m(null))},{default:a(()=>[i("新增場次")]),_:1})]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(L,{label:"搜尋",modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=l=>u.value=l),"append-icon":"mdi-magnify","onClick:append":s[2]||(s[2]=l=>p(!0)),onKeydown:s[3]||(s[3]=pe(l=>p(!0),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1}),e(I,{class:"text-center mb-2"},{default:a(()=>[e(d,{cols:"3"},{default:a(()=>[Le]),_:1}),e(d,{cols:"2"},{default:a(()=>[Pe]),_:1}),e(d,{cols:"2"},{default:a(()=>[Ae]),_:1}),e(d,{cols:"3"},{default:a(()=>[De]),_:1}),e(d,{cols:"1"},{default:a(()=>[Fe]),_:1})]),_:1}),e(be,{class:"mx-6"}),e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(ke,null,{default:a(()=>[(C(!0),j(J,null,W(r.value,(l,z)=>(C(),U(ye,{key:l._id,value:l.expanded,onClick:oe=>te(z)},{activator:a(()=>[e(H,{class:"text-center"},{default:a(()=>[e(I,{align:"center"},{default:a(()=>[e(d,{cols:"3"},{default:a(()=>[e(v,null,{default:a(()=>[e(xe,null,{default:a(()=>[i(k(l.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"2"},{default:a(()=>[e(v,null,{default:a(()=>[e(E,null,{default:a(()=>[i(k(l.location),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"2"},{default:a(()=>[e(v,null,{default:a(()=>[e(E,null,{default:a(()=>[i(k(M(l.date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"3"},{default:a(()=>[e(v,null,{default:a(()=>[e(E,null,{default:a(()=>[i(k(l.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(d,{cols:"1"},{default:a(()=>[e(we,null,{default:a(()=>[e(y,{icon:"",variant:"text",color:"blue",onClick:q(oe=>se(l,z),["stop"])},{default:a(()=>[e(fe,null,{default:a(()=>[i("mdi-pencil")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),l.expanded?(C(),U(H,{key:0},{default:a(()=>[e(v,null,{default:a(()=>[e(Se,{sessionId:l._id},null,8,["sessionId"])]),_:2},1024)]),_:2},1024)):_e("",!0)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(X,{modelValue:c.value.open,"onUpdate:modelValue":s[8]||(s[8]=l=>c.value.open=l),persistent:"",width:"500"},{default:a(()=>[e(ae,{onSubmit:q(t(T),["prevent"]),disabled:t(F)},{default:a(()=>[e(K,null,{default:a(()=>[e(h,null,{default:a(()=>[i(k(c.value.id?"編輯場次":"新增場次"),1)]),_:1}),e(L,{label:"名稱",modelValue:t(x).value.value,"onUpdate:modelValue":s[4]||(s[4]=l=>t(x).value.value=l),"error-messages":t(x).errorMessage.value},null,8,["modelValue","error-messages"]),e(L,{label:"地點",modelValue:t(g).value.value,"onUpdate:modelValue":s[5]||(s[5]=l=>t(g).value.value=l),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),e(L,{label:"日期",type:"date",modelValue:t(V).value.value,"onUpdate:modelValue":s[6]||(s[6]=l=>t(V).value.value=l),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),e(Ce,{label:"描述",modelValue:t(S).value.value,"onUpdate:modelValue":s[7]||(s[7]=l=>t(S).value.value=l),"error-messages":t(S).errorMessage.value},null,8,["modelValue","error-messages"]),e(O,null,{default:a(()=>[e(y,{color:"red",loading:t(F),onClick:D},{default:a(()=>[i("取消")]),_:1},8,["loading"]),e(y,{color:"green",type:"submit",loading:t(F)},{default:a(()=>[i("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]),_:1})}}};typeof G=="function"&&G(Me);export{Me as default};
