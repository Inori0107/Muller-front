import{N as B,P as N,O as A,r as x,J as V,o as v,d as T,w as o,b as l,c as h,t as m,V as u,f as d,h as y,T as U,_ as E,a as I,p as J,l as M}from"./index-DmXGs2hY.js";import{V as g}from"./VCol-z06Mw91z.js";import{V as D}from"./VDataTable-DDiWEggY.js";import{V as w}from"./VContainer-JypX1jX1.js";import{V as O,a as S}from"./VTabs-j5FRcpZ7.js";import{V as R}from"./VSheet-DnPhkM-X.js";import{V as j}from"./VMain-CXn5cFDw.js";import"./VList-DUlqQqe5.js";import"./ssrBoot-BbT2pxTJ.js";import"./VDivider-DQZXRd6D.js";import"./VChip-CqSC1gvD.js";import"./VSlideGroup-BLTTtzGK.js";const z={key:0},F={key:1,class:"text-red"},G={__name:"cartProduct",setup(f){const{apiAuth:r}=U();B();const c=N(),k=A(),a=x([]),C=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.p_id.price*e.quantity},{title:"操作",key:"action"}],_=async()=>{var e,s;try{const{data:t}=await r.get("/user/cart_P");a.value=t.result}catch(t){console.log(t),c({text:((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}};_();const i=V(()=>a.value.reduce((e,s)=>e+s.quantity*s.p_id.price,0)),p=async(e,s)=>{const t=await k.addCart_P(e,s);if(c({text:t.text,snackbarProps:{color:t.color}}),t.color==="green"){const n=a.value.findIndex($=>$.p_id._id===e);a.value[n].quantity+=s,a.value[n].quantity<=0&&a.value.splice(n,1)}},q=V(()=>a.value.length>0&&!a.value.some(e=>!e.p_id.sell)),b=x(!1),P=async()=>{b.value=!0;const e=await k.checkout_P();c({text:e.text,snackbarProps:{color:e.color}}),_(),b.value=!1};return(e,s)=>(v(),T(w,null,{default:o(()=>[l(g,{cols:"12"},{default:o(()=>[l(D,{items:a.value,headers:C},{"item.p_id.name":o(({item:t})=>[t.p_id.sell?(v(),h("span",z,m(t.p_id.name),1)):(v(),h("span",F,m(t.p_id.name)+" (已下架)",1))]),"item.quantity":o(({item:t})=>[l(u,{variant:"text",color:"red",onClick:n=>p(t.p_id._id,-1)},{default:o(()=>[d("-")]),_:2},1032,["onClick"]),y("span",null,m(t.quantity),1),l(u,{variant:"text",color:"green",onClick:n=>p(t.p_id._id,1)},{default:o(()=>[d("+")]),_:2},1032,["onClick"])]),"item.action":o(({item:t})=>[l(u,{variant:"text",color:"red",icon:"mdi-delete",onClick:n=>p(t.p_id._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),l(g,{cols:"12",class:"text-center"},{default:o(()=>[y("p",null,"總金額: "+m(i.value),1),l(u,{color:"green",disabled:!q.value,onClick:P},{default:o(()=>[d("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}},H={__name:"cartTicket",setup(f){const{apiAuth:r}=U();B();const c=N(),k=A(),a=x([]),C=[{title:"品名",key:"t_id.name"},{title:"單價",key:"t_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.t_id.price*e.quantity},{title:"操作",key:"action"}],_=async()=>{var e,s;try{const{data:t}=await r.get("/user/cart_T");a.value=t.result}catch(t){console.log(t),c({text:((s=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}};_();const i=V(()=>a.value.reduce((e,s)=>e+s.quantity*s.t_id.price,0)),p=async(e,s)=>{const t=await k.addCart_T(e,s);if(c({text:t.text,snackbarProps:{color:t.color}}),t.color==="green"){const n=a.value.findIndex($=>$.t_id._id===e);a.value[n].quantity+=s,a.value[n].quantity<=0&&a.value.splice(n,1)}},q=V(()=>a.value.length>0),b=x(!1),P=async()=>{b.value=!0;const e=await k.checkout_T();c({text:e.text,snackbarProps:{color:e.color}}),_(),b.value=!1};return(e,s)=>(v(),T(w,null,{default:o(()=>[l(g,{cols:"12"},{default:o(()=>[l(D,{items:a.value,headers:C},{"item.t_id.name":o(({item:t})=>[y("span",null,m(t.t_id.name),1)]),"item.quantity":o(({item:t})=>[l(u,{variant:"text",color:"red",onClick:n=>p(t.t_id._id,-1)},{default:o(()=>[d("-")]),_:2},1032,["onClick"]),y("span",null,m(t.quantity),1),l(u,{variant:"text",color:"green",onClick:n=>p(t.t_id._id,1)},{default:o(()=>[d("+")]),_:2},1032,["onClick"])]),"item.action":o(({item:t})=>[l(u,{variant:"text",color:"red",icon:"mdi-delete",onClick:n=>p(t.t_id._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),l(g,{cols:"12",class:"text-center"},{default:o(()=>[y("p",null,"總金額: "+m(i.value),1),l(u,{color:"green",disabled:!q.value,onClick:P},{default:o(()=>[d("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}},K=f=>(J("data-v-f19c4233"),f=f(),M(),f),L=K(()=>y("h1",{class:"text-center"},"購物車",-1)),Q={key:0},W={key:1},X={__name:"cart",setup(f){const r=x(0),c=x(!0);return(k,a)=>{const C=I("v-tab-item"),_=I("v-tabs-items");return v(),T(j,null,{default:o(()=>[l(R,{class:"heroPic"},{default:o(()=>[l(w,{class:"mt-8 bg"},{default:o(()=>[L,l(O,{class:"mt-8",modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=i=>r.value=i),"fixed-tabs":"false"},{default:o(()=>[l(S,{onClick:a[0]||(a[0]=i=>c.value=!0)},{default:o(()=>[d("產品")]),_:1}),l(S,{onClick:a[1]||(a[1]=i=>c.value=!1)},{default:o(()=>[d("票券")]),_:1})]),_:1},8,["modelValue"]),l(_,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=i=>r.value=i)},{default:o(()=>[l(C,null,{default:o(()=>[c.value?(v(),h("div",Q,[l(G)])):(v(),h("div",W,[l(H)]))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}},ut=E(X,[["__scopeId","data-v-f19c4233"]]);export{ut as default};
